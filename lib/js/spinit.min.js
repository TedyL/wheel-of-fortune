!function(n){function t(n,t){return Math.floor(Math.random()*(t-n+1)+n)}var i={instance:{},angles:{},spinning:!1,severSpinning:!1,defaults:{clockwise:!0,startDegree:0,turn:7,radius:20,duration:6e3,transition:"cubic-bezier(.25,0,.17,1)",installUrl:null,luckyUrl:null,keyUrl:null,encryptionKey:null},options:{},setEncryptionKey:function(){null!=i.options.keyUrl&&n.ajax({method:"POST",dataType:"json",url:i.options.keyUrl}).done(function(n){i.options.encryptionKey=n.key})},resetEncrptionKey:function(t){null!=i.options.keyUrl&&n.ajax({method:"POST",dataType:"json",url:i.options.keyUrl}).done(function(n){i.options.encryptionKey=n.key,t()})},setAngle:function(){null!=i.options.installUrl?n.ajax({method:"POST",dataType:"json",url:i.options.installUrl}).done(function(t){var e=t
e.length>0&&(i.setEncryptionKey(),n(e).each(function(n,t){i.angles[t.EncrptionCode]={start:t.Start,end:t.End}}))}):n(i.instance).children("*").each(function(t,e){void 0!==n(e).data("spinit-start")&&void 0!==n(e).data("spinit-end")&&void 0!==n(e).data("spinit-id")&&(i.angles[n(e).data("spinit-id")]={start:n(e).data("spinit-start"),end:n(e).data("spinit-end")})})},getAngle:function(n){return void 0!==i.angles[n+""]&&null!=i.angles[n+""]?i.angles[n+""]:!1},initLayout:function(){},algorithm:function(n){var e=t(parseInt(i.getAngle(n).start)+i.options.radius,parseInt(i.getAngle(n).end)-i.options.radius)
if(i.options.clockwise)var o=360*i.options.turn-e-i.options.startDegree
else var o=-(360*i.options.turn)-e-i.options.startDegree
return o},spin:function(t,e){function o(){n(i.instance).transition({rotate:"0deg"},0,"ease")}return 0!=i.spinning?(console.log("results still spinning. Please wait for it."),!1):(i.spinning=!0,o(),void(void 0!==i.angles[t+""]&&null!=i.angles[t+""]?n(i.instance).transition({rotate:i.algorithm(t)+"deg"},i.options.duration,i.options.transition,function(){console.log("finish spinning"),i.spinning=!1,e()}):console.log("Invalid room id detected")))},serverSpin:function(t){return 0!=i.severSpinning?(console.log("results still spinning. Please wait for it."),!1):(i.severSpinning=!0,void(null!=i.options.luckyUrl?n.ajax({method:"POST",dataType:"json",url:i.options.luckyUrl,data:{key:i.options.encryptionKey}}).done(function(n){n.success?i.spin(n.id,function(){i.resetEncrptionKey(function(){i.severSpinning=!1,t()})}):console.log(n.message)}):console.log("Please define luckyUrl in options.")))},init:function(t){i.instance=this,i.options=n.extend(i.defaults,t),i.setAngle(),i.initLayout()}}
n.fn.spinit=function(t,e){return i[t]?i[t].apply(this,Array.prototype.slice.call(arguments,1),e):"object"!=typeof t&&t?void n.error("Method "+t+" doesn't exist on jQuery spintit"):i.init.apply(this,arguments)}}(jQuery)
